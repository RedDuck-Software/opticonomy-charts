apiVersion: v1
kind: ConfigMap
metadata:
  name: haproxy-config
data:
  haproxy.cfg: |
    global
        log stdout format raw local0
        maxconn 4096

    defaults
        log global
        mode tcp
        retries 3
        timeout connect 60s
        timeout client 60s
        timeout server 60s

    frontend ft_rpc_ws
        bind *:80
        mode tcp
        option tcplog
        acl is_rpc path_beg /rpc
        acl is_ws path_beg /ws
        use_backend bk_rpc if is_rpc
        use_backend bk_ws if is_ws

    backend bk_rpc
        mode tcp
        balance roundrobin
        server rpc1 opticonomy-node-opticonomy-node-rpc.default.svc.cluster.local:9964 check

    backend bk_ws
        mode tcp
        balance roundrobin
        server ws1 opticonomy-node-opticonomy-node-rpc.default.svc.cluster.local:9953 check
